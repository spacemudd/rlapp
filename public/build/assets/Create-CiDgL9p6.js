import{d as R,x as B,r as A,c as E,w as J,a as u,o as m,b as s,u as t,g as K,e as l,f as r,S as O,h as i,t as d,i as L,j as _,F as Q,J as W}from"./app-dzhYHfQ6.js";import{_ as G}from"./AppLayout.vue_vue_type_script_setup_true_lang-FNdA422i.js";import{_ as C,a as w,b as V,c as D}from"./CardTitle.vue_vue_type_script_setup_true_lang-b-trmVe4.js";import{_ as k}from"./CardDescription.vue_vue_type_script_setup_true_lang-BHp0wru-.js";import{_ as f}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DdsWb3Js.js";import{_ as y}from"./Input.vue_vue_type_script_setup_true_lang-B5pWYQo0.js";import{_ as p}from"./Label.vue_vue_type_script_setup_true_lang-CrNC81gh.js";import{_ as T}from"./Textarea.vue_vue_type_script_setup_true_lang-Dcsq_i-R.js";import{_ as H,a as X,b as Y,c as Z}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BJiuQUbd.js";import{_ as h}from"./DialogHeader.vue_vue_type_script_setup_true_lang-CwzYDj4m.js";import{_ as ee}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-BNbh0fbp.js";import{_ as z}from"./AsyncCombobox.vue_vue_type_script_setup_true_lang-C14qoc0E.js";import{_ as te}from"./CreateCustomerForm.vue_vue_type_script_setup_true_lang-BZ2UkvnW.js";import{A as se}from"./arrow-left-Bt2z0iwT.js";import{U as oe}from"./user-Br62xq4L.js";import{P as le}from"./plus-Bh08mIoj.js";import{C as ae,F as re}from"./AppSidebarLayout.vue_vue_type_script_setup_true_lang-BXa7DggV.js";import{C as ie}from"./calendar-DjaopmDs.js";import{D as ne}from"./dollar-sign-CBcnLXsd.js";import"./useForwardExpose-CSgtMcpZ.js";import"./RovingFocusGroup-DiTamV0A.js";import"./check-XXtcHlSA.js";import"./InputError.vue_vue_type_script_setup_true_lang-B_0wGZMY.js";const de={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ue={class:"space-y-6"},me={class:"flex items-center justify-between"},_e={class:"text-right"},fe={class:"text-gray-600 mt-1"},pe={class:"grid gap-6 lg:grid-cols-2"},ce={class:"pt-4 border-t"},ye={class:"flex items-center justify-between"},xe={key:0,class:"p-3 bg-gray-50 rounded-md"},ge={class:"grid grid-cols-3 gap-2 text-sm"},ve={class:"font-medium"},be={class:"font-medium"},Ce={class:"font-medium"},we={class:"grid gap-4 md:grid-cols-2"},Ve={class:"space-y-2"},De={key:0,class:"text-sm text-red-600"},ke={class:"space-y-2"},Se={key:0,class:"text-sm text-red-600"},$e={class:"space-y-3"},Ae={class:"flex flex-wrap gap-2"},Ne={key:0,class:"p-3 bg-blue-50 rounded-md"},Ue={class:"text-sm text-blue-800"},Ee={class:"grid gap-4 md:grid-cols-2"},Oe={class:"space-y-2"},Te={key:0,class:"text-sm text-red-600"},ze={class:"space-y-2"},Ie={key:0,class:"text-sm text-red-600"},Me={key:0,class:"p-4 bg-green-50 border border-green-200 rounded-md"},je={class:"flex justify-between items-center"},qe={class:"text-2xl font-bold text-green-900"},Fe={class:"text-sm text-green-700 mt-1"},Pe={class:"grid gap-4 md:grid-cols-2"},Re={class:"space-y-2"},Be={key:0,class:"text-sm text-red-600"},Je={class:"space-y-2"},Ke={key:0,class:"text-sm text-red-600"},Le={class:"space-y-2"},Qe={key:0,class:"text-sm text-red-600"},We={class:"space-y-2"},Ge={key:0,class:"text-sm text-red-600"},He={class:"flex justify-end gap-3"},vt=R({__name:"Create",props:{contractNumber:{},newCustomer:{}},setup(I){const M=I,o=B({customer_id:"",vehicle_id:"",start_date:"",end_date:"",daily_rate:0,deposit_amount:0,mileage_limit:"",excess_mileage_rate:"",terms_and_conditions:"",notes:""}),x=A(null),S=A(!1),g=A(null),v=E(()=>{if(!o.start_date||!o.end_date)return 0;const n=new Date(o.start_date),e=new Date(o.end_date),a=Math.abs(e.getTime()-n.getTime());return Math.ceil(a/(1e3*60*60*24))+1}),N=E(()=>o.daily_rate*v.value),j=n=>{x.value=n,o.daily_rate=n.price_daily},q=n=>{W.post("/customers",n.data(),{onSuccess:e=>{var $,U;console.log("Customer creation success, page:",e),console.log("Page props:",e.props),console.log("Flash data:",e.props.flash);const a=e.props.newCustomer||(($=e.props.flash)==null?void 0:$.newCustomer)||((U=e.props.flash)==null?void 0:U.customer)||e.props.customer||null;console.log("Found customer data:",a),a?(o.customer_id=a.id,g.value?(console.log("Calling selectOption with:",a),g.value.selectOption(a)):console.log("Combobox ref not available")):console.log("No customer data found in response"),S.value=!1},onError:e=>{console.log("Validation errors:",e),Object.keys(e).forEach(a=>{a in n.errors&&n.setError(a,e[a])})},headers:{Accept:"application/json"}})},F=()=>{S.value=!1},b=(n,e="AED")=>new Intl.NumberFormat("en-AE",{style:"currency",currency:e,minimumFractionDigits:2}).format(n),c=n=>{o.start_date||(o.start_date=new Date().toISOString().slice(0,16));const e=new Date(o.start_date),a=new Date(e);a.setDate(e.getDate()+n-1),o.end_date=a.toISOString().slice(0,16)},P=()=>{o.post(route("contracts.store"))};return J(()=>M.newCustomer,n=>{console.log("New customer prop received:",n),n&&(o.customer_id=n.id,g.value&&(console.log("Auto-selecting customer from props:",n),g.value.selectOption(n)))},{immediate:!0}),(n,e)=>(m(),u(Q,null,[s(t(K),{title:"Create Contract"}),s(G,null,{default:l(()=>[r("div",de,[r("div",ue,[r("div",me,[s(t(O),{href:n.route("contracts.index")},{default:l(()=>[s(t(f),{variant:"ghost",size:"sm"},{default:l(()=>[s(t(se),{class:"w-4 h-4 mr-2"}),e[18]||(e[18]=i(" Back to Contracts "))]),_:1,__:[18]})]),_:1},8,["href"]),r("div",_e,[e[19]||(e[19]=r("h1",{class:"text-2xl font-semibold text-gray-900"},"Create New Contract",-1)),r("p",fe,"Contract Number: "+d(n.contractNumber),1)])]),r("form",{onSubmit:L(P,["prevent"]),class:"space-y-6"},[r("div",pe,[s(t(C),null,{default:l(()=>[s(t(w),null,{default:l(()=>[s(t(V),{class:"flex items-center gap-2"},{default:l(()=>[s(t(oe),{class:"w-5 h-5"}),e[20]||(e[20]=i(" Customer Information "))]),_:1,__:[20]}),s(t(k),null,{default:l(()=>e[21]||(e[21]=[i("Select or create a customer for this contract")])),_:1,__:[21]})]),_:1}),s(t(D),{class:"space-y-4"},{default:l(()=>[s(z,{ref_key:"customerComboboxRef",ref:g,modelValue:t(o).customer_id,"onUpdate:modelValue":e[0]||(e[0]=a=>t(o).customer_id=a),label:"Customer",placeholder:"Search customers...","search-url":"/api/customers/search",required:!0,error:t(o).errors.customer_id},null,8,["modelValue","error"]),r("div",ce,[r("div",ye,[e[25]||(e[25]=r("p",{class:"text-sm text-gray-500"}," Need to add a new customer? ",-1)),s(t(H),{open:S.value,"onUpdate:open":e[1]||(e[1]=a=>S.value=a)},{default:l(()=>[s(t(ee),{"as-child":""},{default:l(()=>[s(t(f),{type:"button",variant:"outline",size:"sm"},{default:l(()=>[s(t(le),{class:"w-4 h-4 mr-2"}),e[22]||(e[22]=i(" Create Customer "))]),_:1,__:[22]})]),_:1}),s(t(X),{class:"max-w-2xl max-h-[90vh] overflow-y-auto"},{default:l(()=>[s(t(h),null,{default:l(()=>[s(t(Y),null,{default:l(()=>e[23]||(e[23]=[i("Create New Customer")])),_:1,__:[23]}),s(t(Z),null,{default:l(()=>e[24]||(e[24]=[i(" Add a new customer to your database. All fields marked with * are required. ")])),_:1,__:[24]})]),_:1}),s(te,{onSubmit:q,onCancel:F})]),_:1})]),_:1},8,["open"])])])]),_:1})]),_:1}),s(t(C),null,{default:l(()=>[s(t(w),null,{default:l(()=>[s(t(V),{class:"flex items-center gap-2"},{default:l(()=>[s(t(ae),{class:"w-5 h-5"}),e[26]||(e[26]=i(" Vehicle Information "))]),_:1,__:[26]}),s(t(k),null,{default:l(()=>e[27]||(e[27]=[i("Select the vehicle for this rental")])),_:1,__:[27]})]),_:1}),s(t(D),{class:"space-y-4"},{default:l(()=>[s(z,{modelValue:t(o).vehicle_id,"onUpdate:modelValue":e[2]||(e[2]=a=>t(o).vehicle_id=a),label:"Vehicle",placeholder:"Search vehicles...","search-url":"/api/vehicles/search",required:!0,error:t(o).errors.vehicle_id,onOptionSelected:j},null,8,["modelValue","error"]),x.value?(m(),u("div",xe,[e[31]||(e[31]=r("h4",{class:"font-medium text-gray-900 mb-2"},"Pricing Options",-1)),r("div",ge,[r("div",null,[e[28]||(e[28]=r("span",{class:"text-gray-500"},"Daily:",-1)),r("p",ve,d(b(x.value.price_daily)),1)]),r("div",null,[e[29]||(e[29]=r("span",{class:"text-gray-500"},"Weekly:",-1)),r("p",be,d(b(x.value.price_weekly)),1)]),r("div",null,[e[30]||(e[30]=r("span",{class:"text-gray-500"},"Monthly:",-1)),r("p",Ce,d(b(x.value.price_monthly)),1)])])])):_("",!0)]),_:1})]),_:1})]),s(t(C),null,{default:l(()=>[s(t(w),null,{default:l(()=>[s(t(V),{class:"flex items-center gap-2"},{default:l(()=>[s(t(ie),{class:"w-5 h-5"}),e[32]||(e[32]=i(" Contract Details "))]),_:1,__:[32]}),s(t(k),null,{default:l(()=>e[33]||(e[33]=[i("Set the rental period and terms")])),_:1,__:[33]})]),_:1}),s(t(D),{class:"space-y-6"},{default:l(()=>[r("div",we,[r("div",Ve,[s(t(p),{for:"start_date"},{default:l(()=>e[34]||(e[34]=[i("Start Date & Time *")])),_:1,__:[34]}),s(t(y),{id:"start_date",type:"datetime-local",modelValue:t(o).start_date,"onUpdate:modelValue":e[3]||(e[3]=a=>t(o).start_date=a),min:new Date().toISOString().slice(0,16),required:""},null,8,["modelValue","min"]),t(o).errors.start_date?(m(),u("div",De,d(t(o).errors.start_date),1)):_("",!0)]),r("div",ke,[s(t(p),{for:"end_date"},{default:l(()=>e[35]||(e[35]=[i("End Date & Time *")])),_:1,__:[35]}),s(t(y),{id:"end_date",type:"datetime-local",modelValue:t(o).end_date,"onUpdate:modelValue":e[4]||(e[4]=a=>t(o).end_date=a),min:t(o).start_date||new Date().toISOString().slice(0,16),required:""},null,8,["modelValue","min"]),t(o).errors.end_date?(m(),u("div",Se,d(t(o).errors.end_date),1)):_("",!0)])]),r("div",$e,[e[43]||(e[43]=r("p",{class:"text-sm font-medium text-gray-700"},"Quick duration:",-1)),r("div",Ae,[s(t(f),{type:"button",variant:"outline",size:"sm",onClick:e[5]||(e[5]=a=>c(1)),class:"text-xs px-3 py-1"},{default:l(()=>e[36]||(e[36]=[i(" 1 day ")])),_:1,__:[36]}),s(t(f),{type:"button",variant:"outline",size:"sm",onClick:e[6]||(e[6]=a=>c(2)),class:"text-xs px-3 py-1"},{default:l(()=>e[37]||(e[37]=[i(" 2 days ")])),_:1,__:[37]}),s(t(f),{type:"button",variant:"outline",size:"sm",onClick:e[7]||(e[7]=a=>c(3)),class:"text-xs px-3 py-1"},{default:l(()=>e[38]||(e[38]=[i(" 3 days ")])),_:1,__:[38]}),s(t(f),{type:"button",variant:"outline",size:"sm",onClick:e[8]||(e[8]=a=>c(4)),class:"text-xs px-3 py-1"},{default:l(()=>e[39]||(e[39]=[i(" 4 days ")])),_:1,__:[39]}),s(t(f),{type:"button",variant:"outline",size:"sm",onClick:e[9]||(e[9]=a=>c(5)),class:"text-xs px-3 py-1"},{default:l(()=>e[40]||(e[40]=[i(" 5 days ")])),_:1,__:[40]}),s(t(f),{type:"button",variant:"outline",size:"sm",onClick:e[10]||(e[10]=a=>c(6)),class:"text-xs px-3 py-1"},{default:l(()=>e[41]||(e[41]=[i(" 6 days ")])),_:1,__:[41]}),s(t(f),{type:"button",variant:"outline",size:"sm",onClick:e[11]||(e[11]=a=>c(7)),class:"text-xs px-3 py-1"},{default:l(()=>e[42]||(e[42]=[i(" 1 week ")])),_:1,__:[42]})])]),v.value>0?(m(),u("div",Ne,[r("p",Ue,[e[44]||(e[44]=r("strong",null,"Rental Period:",-1)),i(" "+d(v.value)+" day"+d(v.value!==1?"s":""),1)])])):_("",!0)]),_:1})]),_:1}),s(t(C),null,{default:l(()=>[s(t(w),null,{default:l(()=>[s(t(V),{class:"flex items-center gap-2"},{default:l(()=>[s(t(ne),{class:"w-5 h-5"}),e[45]||(e[45]=i(" Pricing & Financial Details "))]),_:1,__:[45]}),s(t(k),null,{default:l(()=>e[46]||(e[46]=[i("Set rates and deposit requirements")])),_:1,__:[46]})]),_:1}),s(t(D),{class:"space-y-6"},{default:l(()=>[r("div",Ee,[r("div",Oe,[s(t(p),{for:"daily_rate"},{default:l(()=>e[47]||(e[47]=[i("Daily Rate (AED) *")])),_:1,__:[47]}),s(t(y),{id:"daily_rate",type:"number",step:"0.01",min:"0",modelValue:t(o).daily_rate,"onUpdate:modelValue":e[12]||(e[12]=a=>t(o).daily_rate=a),required:""},null,8,["modelValue"]),t(o).errors.daily_rate?(m(),u("div",Te,d(t(o).errors.daily_rate),1)):_("",!0)]),r("div",ze,[s(t(p),{for:"deposit_amount"},{default:l(()=>e[48]||(e[48]=[i("Security Deposit (AED)")])),_:1,__:[48]}),s(t(y),{id:"deposit_amount",type:"number",step:"0.01",min:"0",modelValue:t(o).deposit_amount,"onUpdate:modelValue":e[13]||(e[13]=a=>t(o).deposit_amount=a)},null,8,["modelValue"]),t(o).errors.deposit_amount?(m(),u("div",Ie,d(t(o).errors.deposit_amount),1)):_("",!0)])]),N.value>0?(m(),u("div",Me,[r("div",je,[e[49]||(e[49]=r("span",{class:"text-green-800 font-medium"},"Total Rental Amount:",-1)),r("span",qe,d(b(N.value)),1)]),r("p",Fe,d(v.value)+" days × "+d(b(t(o).daily_rate)),1)])):_("",!0),r("div",Pe,[r("div",Re,[s(t(p),{for:"mileage_limit"},{default:l(()=>e[50]||(e[50]=[i("Mileage Limit (KM)")])),_:1,__:[50]}),s(t(y),{id:"mileage_limit",type:"number",min:"0",modelValue:t(o).mileage_limit,"onUpdate:modelValue":e[14]||(e[14]=a=>t(o).mileage_limit=a),placeholder:"Unlimited if not specified"},null,8,["modelValue"]),t(o).errors.mileage_limit?(m(),u("div",Be,d(t(o).errors.mileage_limit),1)):_("",!0)]),r("div",Je,[s(t(p),{for:"excess_mileage_rate"},{default:l(()=>e[51]||(e[51]=[i("Excess Mileage Rate (AED/KM)")])),_:1,__:[51]}),s(t(y),{id:"excess_mileage_rate",type:"number",step:"0.01",min:"0",modelValue:t(o).excess_mileage_rate,"onUpdate:modelValue":e[15]||(e[15]=a=>t(o).excess_mileage_rate=a)},null,8,["modelValue"]),t(o).errors.excess_mileage_rate?(m(),u("div",Ke,d(t(o).errors.excess_mileage_rate),1)):_("",!0)])])]),_:1})]),_:1}),s(t(C),null,{default:l(()=>[s(t(w),null,{default:l(()=>[s(t(V),{class:"flex items-center gap-2"},{default:l(()=>[s(t(re),{class:"w-5 h-5"}),e[52]||(e[52]=i(" Terms & Notes "))]),_:1,__:[52]}),s(t(k),null,{default:l(()=>e[53]||(e[53]=[i("Additional contract terms and internal notes")])),_:1,__:[53]})]),_:1}),s(t(D),{class:"space-y-4"},{default:l(()=>[r("div",Le,[s(t(p),{for:"terms_and_conditions"},{default:l(()=>e[54]||(e[54]=[i("Terms and Conditions")])),_:1,__:[54]}),s(t(T),{id:"terms_and_conditions",modelValue:t(o).terms_and_conditions,"onUpdate:modelValue":e[16]||(e[16]=a=>t(o).terms_and_conditions=a),placeholder:"Enter specific terms and conditions for this contract...",rows:"4"},null,8,["modelValue"]),t(o).errors.terms_and_conditions?(m(),u("div",Qe,d(t(o).errors.terms_and_conditions),1)):_("",!0)]),r("div",We,[s(t(p),{for:"notes"},{default:l(()=>e[55]||(e[55]=[i("Internal Notes")])),_:1,__:[55]}),s(t(T),{id:"notes",modelValue:t(o).notes,"onUpdate:modelValue":e[17]||(e[17]=a=>t(o).notes=a),placeholder:"Add any internal notes about this contract...",rows:"3"},null,8,["modelValue"]),t(o).errors.notes?(m(),u("div",Ge,d(t(o).errors.notes),1)):_("",!0)])]),_:1})]),_:1}),r("div",He,[s(t(O),{href:n.route("contracts.index")},{default:l(()=>[s(t(f),{type:"button",variant:"outline"},{default:l(()=>e[56]||(e[56]=[i("Cancel")])),_:1,__:[56]})]),_:1},8,["href"]),s(t(f),{type:"submit",disabled:t(o).processing},{default:l(()=>[i(d(t(o).processing?"Creating...":"Create Contract"),1)]),_:1},8,["disabled"])])],32)])])]),_:1})],64))}});export{vt as default};
