import{z as V,G as B,x as r,r as l,H as U,b as $,o as i,w as P,a as e,c as x,i as T,d as f,e as d,t as o,j as _,v as h,F as C,p as N,g as H}from"./app-CAZ12x1D.js";import{F as v,e as z}from"./AppSidebarLayout.vue_vue_type_script_setup_true_lang-C_VWVAbV.js";import{C as E}from"./clock-5rflaqQg.js";import{C as J}from"./calendar-CTnGLQ5T.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-B6CdmlMU.js";import"./useForwardExpose-DgE0TLrR.js";import"./RovingFocusGroup-D_a6MLvt.js";const W={class:"p-8"},G={class:"flex items-center justify-between mb-6"},R={class:"flex items-center space-x-4"},q={class:"flex items-center space-x-2 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg px-4 py-3 shadow-sm"},K={class:"flex items-center justify-center w-8 h-8 bg-green-100 rounded-full"},O={class:"flex flex-col"},Q={class:"text-sm font-semibold text-green-700"},X={class:"flex items-center space-x-2 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg px-4 py-3 shadow-sm"},Y={class:"flex items-center justify-center w-8 h-8 bg-blue-100 rounded-full"},Z={class:"flex flex-col"},ee={class:"text-sm font-semibold text-blue-700"},te={class:"flex items-center justify-between mb-6"},se={class:"flex items-center space-x-4 text-sm text-gray-600"},oe={class:"flex items-center space-x-1"},ae={class:"flex items-center space-x-1"},ne={class:"flex flex-wrap gap-4 mb-6 items-end"},le={class:"flex flex-col"},re={class:"flex flex-col"},ie={class:"flex flex-col"},de={class:"overflow-x-auto bg-white rounded shadow"},ce={class:"min-w-full divide-y divide-gray-200 text-[10px]"},ue={class:"bg-gray-50"},me={class:"bg-white divide-y divide-gray-200"},xe={class:"px-2 py-1 text-[10px] whitespace-nowrap"},fe={class:"px-2 py-1 text-[10px]"},pe={class:"px-2 py-1 text-[10px]"},be={class:"px-2 py-1 text-[10px]"},ge={class:"px-2 py-1 text-[10px]"},ye={class:"px-2 py-1 text-[10px]"},_e={class:"px-2 py-1 text-[10px]"},he={class:"px-2 py-1 text-[10px]"},ve={class:"px-2 py-1 text-[10px]"},we={class:"px-2 py-1 text-[10px]"},ke={key:0},De=["colspan"],Fe={key:0,class:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50"},Te={class:"bg-white rounded-lg shadow-lg p-8 max-w-2xl w-full relative"},Ce={class:"text-lg font-bold mb-4 flex items-center"},Ne={class:"bg-gray-100 rounded p-4 max-h-96 overflow-auto text-xs text-gray-800"},Ue=V({__name:"Fines",setup(Se){const c=B().props.fines||[],w=r(()=>c.length===0?null:[...c].sort((s,t)=>{const n=new Date(s.dateandtime||0);return new Date(t.dateandtime||0).getTime()-n.getTime()})[0].dateandtime);r(()=>{if(!w.value)return"N/A";const a=new Date(w.value),t=Math.floor((new Date().getTime()-a.getTime())/(1e3*60*60));return t<1?"Just now":t<24?`${t} hours ago`:`${Math.floor(t/24)} days ago`});const g=l(null),k=async()=>{try{const s=await(await fetch("/fines/last-sync")).json();s.last_sync&&(g.value=s.last_sync)}catch(a){console.error("Failed to fetch last sync:",a)}};k(),setInterval(k,6e4);const S=r(()=>{if(!g.value)return"N/A";const a=new Date(g.value),t=Math.floor((new Date().getTime()-a.getTime())/(1e3*60));return t<1?"Just now":t<60?`${t} minutes ago`:t<1440?`${Math.floor(t/60)} hours ago`:`${Math.floor(t/1440)} days ago`}),I=r(()=>c.reduce((a,s)=>{var n;const t=parseFloat(((n=s.amount)==null?void 0:n.toString())||"0");return a+t},0)),A=r(()=>new Intl.NumberFormat("en-US",{style:"currency",currency:"AED",minimumFractionDigits:0,maximumFractionDigits:0}).format(I.value)),D=[{key:"row_number",label:"#"},{key:"car_name",label:"Car Name"},{key:"plate_code",label:"Plate Code"},{key:"plate_number",label:"Plate Number"},{key:"dateandtime",label:"Date & Time"},{key:"location",label:"Location"},{key:"source",label:"Source"},{key:"amount",label:"Amount"},{key:"fine_number",label:"Fine Number"},{key:"details",label:"Details"}],L=l(!1),F=l(!1),j=l(""),u=l(""),m=l(""),p=l(""),y=r(()=>c.filter(a=>{if(p.value&&a.plate_number&&!a.plate_number.toString().includes(p.value.trim()))return!1;if(!u.value&&!m.value)return!0;if(!a.dateandtime)return!1;const s=new Date(a.dateandtime.replace(/-/g,"/"));let t=!0,n=!0;if(u.value&&(t=s>=new Date(u.value)),m.value){const b=new Date(m.value);b.setDate(b.getDate()+1),n=s<b}return t&&n})),M=()=>{F.value=!1,L.value=!1};return U(()=>{}),(a,s)=>(i(),$(z,{breadcrumbs:[{title:"Check Fines",href:"/fines"}]},{default:P(()=>[e("div",W,[e("div",G,[s[5]||(s[5]=e("h1",{class:"text-2xl font-bold"},"Check Fines With RTA",-1)),e("div",R,[e("div",q,[e("div",K,[f(d(v),{class:"w-4 h-4 text-green-600"})]),e("div",O,[s[3]||(s[3]=e("span",{class:"text-xs font-medium text-green-900"},"Total Amount",-1)),e("span",Q,o(A.value),1)])]),e("div",X,[e("div",Y,[f(d(E),{class:"w-4 h-4 text-blue-600"})]),e("div",Z,[s[4]||(s[4]=e("span",{class:"text-xs font-medium text-blue-900"},"Last Sync",-1)),e("span",ee,o(S.value),1)])])])]),e("div",te,[e("div",se,[e("div",oe,[f(d(J),{class:"w-4 h-4"}),e("span",null,"Total Fines: "+o(d(c).length),1)]),e("div",ae,[f(d(v),{class:"w-4 h-4"}),e("span",null,"Showing: "+o(y.value.length),1)])])]),e("div",ne,[e("div",le,[s[6]||(s[6]=e("label",{class:"block text-xs font-semibold mb-1 text-gray-700"},"From Date",-1)),_(e("input",{type:"date","onUpdate:modelValue":s[0]||(s[0]=t=>u.value=t),class:"border border-gray-300 rounded-lg px-3 py-2 text-xs focus:ring-2 focus:ring-blue-400 focus:border-blue-400 shadow-sm transition"},null,512),[[h,u.value]])]),e("div",re,[s[7]||(s[7]=e("label",{class:"block text-xs font-semibold mb-1 text-gray-700"},"To Date",-1)),_(e("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=t=>m.value=t),class:"border border-gray-300 rounded-lg px-3 py-2 text-xs focus:ring-2 focus:ring-blue-400 focus:border-blue-400 shadow-sm transition"},null,512),[[h,m.value]])]),e("div",ie,[s[8]||(s[8]=e("label",{class:"block text-xs font-semibold mb-1 text-gray-700"},"Plate Number",-1)),_(e("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=t=>p.value=t),class:"border border-gray-300 rounded-lg px-3 py-2 text-xs focus:ring-2 focus:ring-blue-400 focus:border-blue-400 shadow-sm transition",placeholder:"Search by plate number..."},null,512),[[h,p.value]])])]),e("div",de,[e("table",ce,[e("thead",ue,[e("tr",null,[(i(),x(C,null,N(D,t=>e("th",{key:t.key,class:"px-2 py-1 text-left font-medium text-gray-500 uppercase tracking-wider text-[10px] whitespace-nowrap"},o(t.label),1)),64))])]),e("tbody",me,[(i(!0),x(C,null,N(y.value,(t,n)=>(i(),x("tr",{key:t.id},[e("td",xe,o(n+1),1),e("td",fe,o(t.car_name),1),e("td",pe,o(t.plate_code),1),e("td",be,o(t.plate_number),1),e("td",ge,o(t.dateandtime),1),e("td",ye,o(t.location),1),e("td",_e,o(t.source),1),e("td",he,o(t.amount),1),e("td",ve,o(t.fine_number),1),e("td",we,o(t.details),1)]))),128)),y.value.length?T("",!0):(i(),x("tr",ke,[e("td",{colspan:D.length,class:"text-center py-8 text-gray-400"},"No fines found.",8,De)]))])])]),F.value?(i(),x("div",Fe,[e("div",Te,[e("h2",Ce,[f(d(v),{class:"w-5 h-5 mr-2"}),s[9]||(s[9]=H("Please Wait and Don't Close this window."))]),e("pre",Ne,o(j.value||"No log yet..."),1),e("button",{onClick:M,class:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"},"Close")])])):T("",!0)])]),_:1}))}});export{Ue as default};
