import{d as Z,x as Q,r as U,c as O,w as E,o as X,a as u,b as m,e as s,u as t,g as ee,f as r,h as o,S as I,i,t as d,j as te,k as _,F as se,J as ae}from"./app-B4CXrxA6.js";import{_ as oe}from"./AppLayout.vue_vue_type_script_setup_true_lang-j6gg2DV2.js";import{_ as b,a as D}from"./CardContent.vue_vue_type_script_setup_true_lang-m18NTIW-.js";import{_ as w}from"./CardDescription.vue_vue_type_script_setup_true_lang-BIyOCfqp.js";import{_ as C,a as V}from"./CardTitle.vue_vue_type_script_setup_true_lang-D4-SZOu1.js";import{_ as k}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-STRE1Pnw.js";import{_ as p}from"./Input.vue_vue_type_script_setup_true_lang-DDdmzXzU.js";import{_ as f}from"./Label.vue_vue_type_script_setup_true_lang-CATyK9aN.js";import{_ as q}from"./Textarea.vue_vue_type_script_setup_true_lang-IN3GIl-3.js";import{_ as re,a as le,b as ne,c as ie}from"./DialogTitle.vue_vue_type_script_setup_true_lang-FpgTBn8y.js";import{_ as de}from"./DialogHeader.vue_vue_type_script_setup_true_lang-N81L0UwJ.js";import{_ as ue}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-Dyc_y_dE.js";import{_ as j}from"./AsyncCombobox.vue_vue_type_script_setup_true_lang-DNWB07lu.js";import{_ as me}from"./CreateCustomerForm.vue_vue_type_script_setup_true_lang-Dke6jO2D.js";import{A as _e}from"./arrow-left-D65Fh--l.js";import{U as fe}from"./user-L3Yh0_nP.js";import{P as ce}from"./plus-CV8EWWeN.js";import{C as pe,F as ge}from"./AppSidebarLayout.vue_vue_type_script_setup_true_lang-DjycHvFz.js";import{C as ye}from"./calendar-DJueTjsM.js";import{D as xe}from"./dollar-sign-CHlIRE9b.js";import"./useForwardExpose-e-VyqxC-.js";import"./RovingFocusGroup-Bp_bgarQ.js";import"./check-B2C48of2.js";import"./InputError.vue_vue_type_script_setup_true_lang-D97mxckp.js";const ve={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},be={class:"space-y-6"},De={class:"flex items-center justify-between"},we={class:"text-right"},Ce={class:"text-gray-600 mt-1"},Ve={class:"grid gap-6 lg:grid-cols-2"},Se={class:"pt-4 border-t"},Te={class:"flex items-center justify-between"},he={key:0,class:"p-3 bg-gray-50 rounded-md"},$e={class:"grid grid-cols-3 gap-2 text-sm"},Ue={class:"font-medium"},ke={class:"font-medium"},Ee={class:"font-medium"},Ae={class:"grid gap-4 md:grid-cols-2"},Me={class:"space-y-2"},Ne={key:0,class:"text-sm text-red-600"},Fe={class:"space-y-2"},Oe={key:0,class:"text-sm text-red-600"},Ie={class:"space-y-3"},qe={class:"grid gap-4 md:grid-cols-3"},je={class:"space-y-2"},Re={class:"md:col-span-2 flex items-end"},Pe={class:"p-3 bg-blue-50 rounded-md w-full"},ze={class:"text-sm text-blue-800"},Be={key:0,class:"block text-xs mt-1"},Le={class:"grid gap-4 md:grid-cols-2"},Ge={class:"space-y-2"},Je={key:0,class:"text-sm text-red-600"},Ke={class:"space-y-2"},He={key:0,class:"text-sm text-red-600"},We={key:0,class:"p-4 bg-green-50 border border-green-200 rounded-md"},Ye={class:"flex justify-between items-center"},Ze={class:"text-2xl font-bold text-green-900"},Qe={class:"text-sm text-green-700 mt-1"},Xe={class:"grid gap-4 md:grid-cols-2"},et={class:"space-y-2"},tt={key:0,class:"text-sm text-red-600"},st={class:"space-y-2"},at={key:0,class:"text-sm text-red-600"},ot={class:"space-y-2"},rt={key:0,class:"text-sm text-red-600"},lt={class:"space-y-2"},nt={key:0,class:"text-sm text-red-600"},it={class:"flex justify-end gap-3"},R=4*60,Mt=Z({__name:"Create",props:{contractNumber:{},newCustomer:{}},setup(P){const z=P,a=Q({customer_id:"",vehicle_id:"",start_date:"",end_date:"",daily_rate:0,deposit_amount:0,mileage_limit:"",excess_mileage_rate:"",terms_and_conditions:"",notes:""}),g=U(null),S=U(!1),y=U(null),c=U(1),T=O(()=>{if(!a.start_date||!a.end_date)return 0;const l=new Date(a.start_date),e=new Date(a.end_date),n=Math.abs(e.getTime()-l.getTime());return Math.ceil(n/(1e3*60*60*24))}),A=O(()=>a.daily_rate*T.value),B=l=>{g.value=l,a.daily_rate=l.price_daily},L=l=>{ae.post("/customers",l.data(),{onSuccess:e=>{var v,$;console.log("Customer creation success, page:",e),console.log("Page props:",e.props),console.log("Flash data:",e.props.flash);const n=e.props.newCustomer||((v=e.props.flash)==null?void 0:v.newCustomer)||(($=e.props.flash)==null?void 0:$.customer)||e.props.customer||null;console.log("Found customer data:",n),n?(a.customer_id=n.id,y.value?(console.log("Calling selectOption with:",n),y.value.selectOption(n)):console.log("Combobox ref not available")):console.log("No customer data found in response"),S.value=!1},onError:e=>{console.log("Validation errors:",e),Object.keys(e).forEach(n=>{n in l.errors&&l.setError(n,e[n])})},headers:{Accept:"application/json"}})},G=()=>{S.value=!1},x=(l,e="AED")=>new Intl.NumberFormat("en-AE",{style:"currency",currency:e,minimumFractionDigits:2}).format(l),J=()=>{const l=new Date;return new Date(l.getTime()+l.getTimezoneOffset()*6e4)},K=l=>new Date(l.getTime()+R*6e4),M=l=>new Date(l.getTime()-R*6e4),N=l=>{const e=l.getFullYear(),n=String(l.getMonth()+1).padStart(2,"0"),v=String(l.getDate()).padStart(2,"0"),$=String(l.getHours()).padStart(2,"0"),Y=String(l.getMinutes()).padStart(2,"0");return`${e}-${n}-${v}T${$}:${Y}`},F=()=>{const l=J(),e=K(l);return N(e)},h=()=>{if(!a.start_date||!c.value||c.value<1)return;const l=new Date(a.start_date),e=new Date(l);e.setDate(l.getDate()+c.value),a.end_date=N(e)},H=()=>{a.start_date||(a.start_date=F(),h())};E(c,()=>{a.start_date&&h()}),E(()=>a.start_date,()=>{a.start_date&&c.value>0&&h()});const W=()=>{const l={...a.data()};if(l.start_date){const e=new Date(l.start_date),n=M(e);l.start_date=n.toISOString()}if(l.end_date){const e=new Date(l.end_date),n=M(e);l.end_date=n.toISOString()}a.transform(e=>l).post(route("contracts.store"))};return X(()=>{a.start_date||(a.start_date=F(),h())}),E(()=>z.newCustomer,l=>{console.log("New customer prop received:",l),l&&(a.customer_id=l.id,y.value&&(console.log("Auto-selecting customer from props:",l),y.value.selectOption(l)))},{immediate:!0}),(l,e)=>(m(),u(se,null,[s(t(ee),{title:"Create Contract"}),s(oe,null,{default:r(()=>[o("div",ve,[o("div",be,[o("div",De,[s(t(I),{href:l.route("contracts.index")},{default:r(()=>[s(t(k),{variant:"ghost",size:"sm"},{default:r(()=>[s(t(_e),{class:"w-4 h-4 mr-2"}),e[12]||(e[12]=i(" Back to Contracts "))]),_:1,__:[12]})]),_:1},8,["href"]),o("div",we,[e[13]||(e[13]=o("h1",{class:"text-2xl font-semibold text-gray-900"},"Create New Contract",-1)),o("p",Ce,"Contract Number: "+d(l.contractNumber),1)])]),o("form",{onSubmit:te(W,["prevent"]),class:"space-y-6"},[o("div",Ve,[s(t(b),null,{default:r(()=>[s(t(C),null,{default:r(()=>[s(t(V),{class:"flex items-center gap-2"},{default:r(()=>[s(t(fe),{class:"w-5 h-5"}),e[14]||(e[14]=i(" Customer Information "))]),_:1,__:[14]}),s(t(w),null,{default:r(()=>e[15]||(e[15]=[i("Select or create a customer for this contract")])),_:1,__:[15]})]),_:1}),s(t(D),{class:"space-y-4"},{default:r(()=>[s(j,{ref_key:"customerComboboxRef",ref:y,modelValue:t(a).customer_id,"onUpdate:modelValue":e[0]||(e[0]=n=>t(a).customer_id=n),label:"Customer",placeholder:"Search customers...","search-url":"/api/customers/search",required:!0,error:t(a).errors.customer_id},null,8,["modelValue","error"]),o("div",Se,[o("div",Te,[e[19]||(e[19]=o("p",{class:"text-sm text-gray-500"}," Need to add a new customer? ",-1)),s(t(re),{open:S.value,"onUpdate:open":e[1]||(e[1]=n=>S.value=n)},{default:r(()=>[s(t(ue),{"as-child":""},{default:r(()=>[s(t(k),{type:"button",variant:"outline",size:"sm"},{default:r(()=>[s(t(ce),{class:"w-4 h-4 mr-2"}),e[16]||(e[16]=i(" Create Customer "))]),_:1,__:[16]})]),_:1}),s(t(le),{class:"max-w-2xl max-h-[90vh] overflow-y-auto"},{default:r(()=>[s(t(de),null,{default:r(()=>[s(t(ne),null,{default:r(()=>e[17]||(e[17]=[i("Create New Customer")])),_:1,__:[17]}),s(t(ie),null,{default:r(()=>e[18]||(e[18]=[i(" Add a new customer to your database. All fields marked with * are required. ")])),_:1,__:[18]})]),_:1}),s(me,{onSubmit:L,onCancel:G})]),_:1})]),_:1},8,["open"])])])]),_:1})]),_:1}),s(t(b),null,{default:r(()=>[s(t(C),null,{default:r(()=>[s(t(V),{class:"flex items-center gap-2"},{default:r(()=>[s(t(pe),{class:"w-5 h-5"}),e[20]||(e[20]=i(" Vehicle Information "))]),_:1,__:[20]}),s(t(w),null,{default:r(()=>e[21]||(e[21]=[i("Select the vehicle for this rental")])),_:1,__:[21]})]),_:1}),s(t(D),{class:"space-y-4"},{default:r(()=>[s(j,{modelValue:t(a).vehicle_id,"onUpdate:modelValue":e[2]||(e[2]=n=>t(a).vehicle_id=n),label:"Vehicle",placeholder:"Search vehicles...","search-url":"/api/vehicles/search",required:!0,error:t(a).errors.vehicle_id,onOptionSelected:B},null,8,["modelValue","error"]),g.value?(m(),u("div",he,[e[25]||(e[25]=o("h4",{class:"font-medium text-gray-900 mb-2"},"Pricing Options",-1)),o("div",$e,[o("div",null,[e[22]||(e[22]=o("span",{class:"text-gray-500"},"Daily:",-1)),o("p",Ue,d(x(g.value.price_daily)),1)]),o("div",null,[e[23]||(e[23]=o("span",{class:"text-gray-500"},"Weekly:",-1)),o("p",ke,d(x(g.value.price_weekly)),1)]),o("div",null,[e[24]||(e[24]=o("span",{class:"text-gray-500"},"Monthly:",-1)),o("p",Ee,d(x(g.value.price_monthly)),1)])])])):_("",!0)]),_:1})]),_:1})]),s(t(b),null,{default:r(()=>[s(t(C),null,{default:r(()=>[s(t(V),{class:"flex items-center gap-2"},{default:r(()=>[s(t(ye),{class:"w-5 h-5"}),e[26]||(e[26]=i(" Contract Details "))]),_:1,__:[26]}),s(t(w),null,{default:r(()=>e[27]||(e[27]=[i("Set the rental period and terms")])),_:1,__:[27]})]),_:1}),s(t(D),{class:"space-y-6"},{default:r(()=>[o("div",Ae,[o("div",Me,[s(t(f),{for:"start_date"},{default:r(()=>e[28]||(e[28]=[i("Start Date & Time * "),o("span",{class:"text-xs text-gray-500"},"(Dubai Time GMT+4)",-1)])),_:1,__:[28]}),s(t(p),{id:"start_date",type:"datetime-local",modelValue:t(a).start_date,"onUpdate:modelValue":e[3]||(e[3]=n=>t(a).start_date=n),required:""},null,8,["modelValue"]),t(a).errors.start_date?(m(),u("div",Ne,d(t(a).errors.start_date),1)):_("",!0),e[29]||(e[29]=o("p",{class:"text-xs text-gray-500"}," Times are displayed in Dubai timezone (GMT+4) ",-1))]),o("div",Fe,[s(t(f),{for:"end_date"},{default:r(()=>e[30]||(e[30]=[i("End Date & Time * "),o("span",{class:"text-xs text-gray-500"},"(Dubai Time GMT+4)",-1)])),_:1,__:[30]}),s(t(p),{id:"end_date",type:"datetime-local",modelValue:t(a).end_date,"onUpdate:modelValue":e[4]||(e[4]=n=>t(a).end_date=n),min:t(a).start_date,required:""},null,8,["modelValue","min"]),t(a).errors.end_date?(m(),u("div",Oe,d(t(a).errors.end_date),1)):_("",!0),e[31]||(e[31]=o("p",{class:"text-xs text-gray-500"}," Automatically calculated based on duration ",-1))])]),o("div",Ie,[o("div",qe,[o("div",je,[s(t(f),{for:"duration_days"},{default:r(()=>e[32]||(e[32]=[i("Duration (Days) *")])),_:1,__:[32]}),s(t(p),{id:"duration_days",type:"number",min:"1",max:"365",modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=n=>c.value=n),modelModifiers:{number:!0},onFocus:H,placeholder:"Enter number of days",required:""},null,8,["modelValue"]),e[33]||(e[33]=o("p",{class:"text-xs text-gray-500"}," Enter the number of rental days (minimum 1 day) ",-1))]),o("div",Re,[o("div",Pe,[o("p",ze,[e[34]||(e[34]=o("strong",null,"Rental Period:",-1)),i(" "+d(T.value)+" day"+d(T.value!==1?"s":"")+" ",1),t(a).start_date&&t(a).end_date?(m(),u("span",Be,d(new Date(t(a).start_date).toLocaleDateString("en-AE",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))+" → "+d(new Date(t(a).end_date).toLocaleDateString("en-AE",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})),1)):_("",!0)])])])])])]),_:1})]),_:1}),s(t(b),null,{default:r(()=>[s(t(C),null,{default:r(()=>[s(t(V),{class:"flex items-center gap-2"},{default:r(()=>[s(t(xe),{class:"w-5 h-5"}),e[35]||(e[35]=i(" Pricing & Financial Details "))]),_:1,__:[35]}),s(t(w),null,{default:r(()=>e[36]||(e[36]=[i("Set rates and deposit requirements")])),_:1,__:[36]})]),_:1}),s(t(D),{class:"space-y-6"},{default:r(()=>[o("div",Le,[o("div",Ge,[s(t(f),{for:"daily_rate"},{default:r(()=>e[37]||(e[37]=[i("Daily Rate (AED) *")])),_:1,__:[37]}),s(t(p),{id:"daily_rate",type:"number",step:"0.01",min:"0",modelValue:t(a).daily_rate,"onUpdate:modelValue":e[6]||(e[6]=n=>t(a).daily_rate=n),required:""},null,8,["modelValue"]),t(a).errors.daily_rate?(m(),u("div",Je,d(t(a).errors.daily_rate),1)):_("",!0)]),o("div",Ke,[s(t(f),{for:"deposit_amount"},{default:r(()=>e[38]||(e[38]=[i("Security Deposit (AED)")])),_:1,__:[38]}),s(t(p),{id:"deposit_amount",type:"number",step:"0.01",min:"0",modelValue:t(a).deposit_amount,"onUpdate:modelValue":e[7]||(e[7]=n=>t(a).deposit_amount=n)},null,8,["modelValue"]),t(a).errors.deposit_amount?(m(),u("div",He,d(t(a).errors.deposit_amount),1)):_("",!0)])]),A.value>0?(m(),u("div",We,[o("div",Ye,[e[39]||(e[39]=o("span",{class:"text-green-800 font-medium"},"Total Rental Amount:",-1)),o("span",Ze,d(x(A.value)),1)]),o("p",Qe,d(T.value)+" days × "+d(x(t(a).daily_rate)),1)])):_("",!0),o("div",Xe,[o("div",et,[s(t(f),{for:"mileage_limit"},{default:r(()=>e[40]||(e[40]=[i("Mileage Limit (KM)")])),_:1,__:[40]}),s(t(p),{id:"mileage_limit",type:"number",min:"0",modelValue:t(a).mileage_limit,"onUpdate:modelValue":e[8]||(e[8]=n=>t(a).mileage_limit=n),placeholder:"Unlimited if not specified"},null,8,["modelValue"]),t(a).errors.mileage_limit?(m(),u("div",tt,d(t(a).errors.mileage_limit),1)):_("",!0)]),o("div",st,[s(t(f),{for:"excess_mileage_rate"},{default:r(()=>e[41]||(e[41]=[i("Excess Mileage Rate (AED/KM)")])),_:1,__:[41]}),s(t(p),{id:"excess_mileage_rate",type:"number",step:"0.01",min:"0",modelValue:t(a).excess_mileage_rate,"onUpdate:modelValue":e[9]||(e[9]=n=>t(a).excess_mileage_rate=n)},null,8,["modelValue"]),t(a).errors.excess_mileage_rate?(m(),u("div",at,d(t(a).errors.excess_mileage_rate),1)):_("",!0)])])]),_:1})]),_:1}),s(t(b),null,{default:r(()=>[s(t(C),null,{default:r(()=>[s(t(V),{class:"flex items-center gap-2"},{default:r(()=>[s(t(ge),{class:"w-5 h-5"}),e[42]||(e[42]=i(" Terms & Notes "))]),_:1,__:[42]}),s(t(w),null,{default:r(()=>e[43]||(e[43]=[i("Additional contract terms and internal notes")])),_:1,__:[43]})]),_:1}),s(t(D),{class:"space-y-4"},{default:r(()=>[o("div",ot,[s(t(f),{for:"terms_and_conditions"},{default:r(()=>e[44]||(e[44]=[i("Terms and Conditions")])),_:1,__:[44]}),s(t(q),{id:"terms_and_conditions",modelValue:t(a).terms_and_conditions,"onUpdate:modelValue":e[10]||(e[10]=n=>t(a).terms_and_conditions=n),placeholder:"Enter specific terms and conditions for this contract...",rows:"4"},null,8,["modelValue"]),t(a).errors.terms_and_conditions?(m(),u("div",rt,d(t(a).errors.terms_and_conditions),1)):_("",!0)]),o("div",lt,[s(t(f),{for:"notes"},{default:r(()=>e[45]||(e[45]=[i("Internal Notes")])),_:1,__:[45]}),s(t(q),{id:"notes",modelValue:t(a).notes,"onUpdate:modelValue":e[11]||(e[11]=n=>t(a).notes=n),placeholder:"Add any internal notes about this contract...",rows:"3"},null,8,["modelValue"]),t(a).errors.notes?(m(),u("div",nt,d(t(a).errors.notes),1)):_("",!0)])]),_:1})]),_:1}),o("div",it,[s(t(I),{href:l.route("contracts.index")},{default:r(()=>[s(t(k),{type:"button",variant:"outline"},{default:r(()=>e[46]||(e[46]=[i("Cancel")])),_:1,__:[46]})]),_:1},8,["href"]),s(t(k),{type:"submit",disabled:t(a).processing},{default:r(()=>[i(d(t(a).processing?"Creating...":"Create Contract"),1)]),_:1},8,["disabled"])])],32)])])]),_:1})],64))}});export{Mt as default};
