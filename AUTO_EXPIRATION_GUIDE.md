# Ù†Ø¸Ø§Ù… Ø§Ù†ØªÙ‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ

## ðŸ“‹ Ø§Ù„ÙˆØµÙ
ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø¸Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ØªÙŠ ØªÙƒÙˆÙ† ÙÙŠ Ø­Ø§Ù„Ø© `pending` Ù„Ø£ÙƒØ«Ø± Ù…Ù† 5 Ø¯Ù‚Ø§Ø¦Ù‚.

**Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©:** Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ·Ø¨Ù‚ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ù…Ù† Ù…ØµØ¯Ø± Ø§Ù„ÙˆÙŠØ¨ (`web`). Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ù…Ù† Ø§Ù„ÙˆÙƒÙŠÙ„ (`agent`) Ù„Ø§ ØªÙ†ØªÙ‡ÙŠ ØµÙ„Ø§Ø­ÙŠØªÙ‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.

**Ù…Ù„Ø§Ø­Ø¸Ø©:** Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­ (ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙˆÙŠØ¨) ØªÙØ¹ØªØ¨Ø± `agent` Ù„Ø£Ù† Ø§Ù„ÙˆÙƒÙŠÙ„ ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ù…ØªØµÙØ­ØŒ Ø¨ÙŠÙ†Ù…Ø§ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ù…Ù† API ØªÙØ¹ØªØ¨Ø± `web` Ù„Ø£Ù†Ù‡Ø§ Ø¢Ù„ÙŠØ©.

## âš™ï¸ ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ

### 1. Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯:
- Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¬Ø² `pending` **ÙˆÙ…ØµØ¯Ø± Ø§Ù„Ø­Ø¬Ø² `web` (API)**
- ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Job Ø¨Ø§Ø³Ù… `ExpireReservationJob` 
- Ø§Ù„Ù€ Job ÙŠØªÙ… Ø¬Ø¯ÙˆÙ„ØªÙ‡ Ù„Ù„ØªØ´ØºÙŠÙ„ Ø¨Ø¹Ø¯ 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ø¨Ø§Ù„Ø¶Ø¨Ø·
- **Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ù…Ù† Ø§Ù„ÙˆÙƒÙŠÙ„ (`agent` - Ø§Ù„Ù…ØªØµÙØ­) Ù„Ø§ ÙŠØªÙ… Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØªÙ‡Ø§**

### 2. Ø¹Ù†Ø¯ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù€ Job:
- ÙŠØ¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø­Ø¬Ø² Ø¨Ø§Ù„Ù€ ID Ø§Ù„Ù…Ø­Ø¯Ø¯
- ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø­Ø¬Ø² Ù„Ø§ ÙŠØ²Ø§Ù„ Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
- ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¬Ø² Ù„Ø§ ØªØ²Ø§Ù„ `pending`
- **ÙŠØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ù…ØµØ¯Ø± Ø§Ù„Ø­Ø¬Ø² Ù‡Ùˆ `web` (API)**
- Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø­Ø¬Ø² Ù„Ø§ ÙŠØ²Ø§Ù„ `pending` ÙˆÙ…ØµØ¯Ø±Ù‡ `web` â†’ ÙŠØºÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ `expired`
- Ø¥Ø°Ø§ ØªØºÙŠØ±Øª Ø§Ù„Ø­Ø§Ù„Ø© Ø£Ùˆ ÙƒØ§Ù† Ø§Ù„Ù…ØµØ¯Ø± `agent` (Ø§Ù„Ù…ØªØµÙØ­) â†’ Ù„Ø§ ÙŠÙØ¹Ù„ Ø´ÙŠØ¡ ÙˆÙŠØ³Ø¬Ù„ ÙÙŠ Ø§Ù„Ù€ log

## ðŸ”„ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù…ÙƒÙ†Ø©

| Ø§Ù„Ø­Ø§Ù„Ø© | Ø§Ù„ÙˆØµÙ | Ø§Ù„Ù„ÙˆÙ† |
|--------|-------|-------|
| `pending` | Ù…Ø¹Ù„Ù‚ - ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯ (5 Ø¯Ù‚Ø§Ø¦Ù‚ Ù„Ù„API ÙÙ‚Ø·) | Ø£ØµÙØ± |
| `confirmed` | Ù…Ø¤ÙƒØ¯ | Ø£Ø²Ø±Ù‚ |
| `completed` | Ù…ÙƒØªÙ…Ù„ | Ø£Ø®Ø¶Ø± |
| `canceled` | Ù…Ù„ØºÙŠ | Ø£Ø­Ù…Ø± |
| `expired` | Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (API ÙÙ‚Ø·) | Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ |

## ðŸ“± Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª

| Ø§Ù„Ù…ØµØ¯Ø± | Ø§Ù„ÙˆØµÙ | Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© |
|--------|-------|------------------|
| `web` | Ø­Ø¬Ø² Ù…Ù† API (Ø¢Ù„ÙŠ) | 5 Ø¯Ù‚Ø§Ø¦Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ |
| `agent` | Ø­Ø¬Ø² Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­ (ÙˆÙƒÙŠÙ„) | Ù„Ø§ ÙŠÙ†ØªÙ‡ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ |

## ðŸ› ï¸ Ù…Ù„ÙØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…

### 1. **ExpireReservationJob** (`app/Jobs/ExpireReservationJob.php`)
```php
// Job ÙŠØ¹Ù…Ù„ Ø¨Ø¹Ø¯ 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©
ExpireReservationJob::dispatch($reservation->id)->delay(now()->addMinutes(5));
```

### 2. **Reservation Model** (`app/Models/Reservation.php`)
```php
// Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯
static::created(function ($reservation) {
    if ($reservation->status === self::STATUS_PENDING) {
        ExpireReservationJob::dispatch($reservation->id)->delay(now()->addMinutes(5));
    }
});
```

### 3. **API Controller** (`app/Http/Controllers/Api/ReservationApiController.php`)
```php
// Ø¥Ø¶Ø§ÙØ© 'expired' Ù„Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©
'status' => 'required|in:pending,confirmed,completed,canceled,expired'
```

## ðŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…

### Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² ØªØ¬Ø±ÙŠØ¨ÙŠ:
```bash
php artisan tinker
```

```php
$reservation = Reservation::create([
    'customer_id' => 'customer-uuid',
    'vehicle_id' => 'vehicle-uuid', 
    'team_id' => 'team-uuid',
    'pickup_date' => '2025-01-26 14:00:00',
    'pickup_location' => 'Airport',
    'return_date' => '2025-01-28 14:00:00',
    'rate' => 180.00,
    'status' => 'pending'
]);

// Job Ø³ÙŠØ¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ 5 Ø¯Ù‚Ø§Ø¦Ù‚
```

### ØªØ´ØºÙŠÙ„ Queue Worker:
```bash
php artisan queue:work
```

### Ù…Ø±Ø§Ù‚Ø¨Ø© Logs:
```bash
tail -f storage/logs/laravel.log
```

## ðŸ“Š Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª Ù…Ø®ØªÙ„ÙØ©

### Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 1: Ø§Ù„Ø­Ø¬Ø² ÙŠØ¨Ù‚Ù‰ pending
```
00:00 - Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² (pending)
00:05 - Job ÙŠØ¹Ù…Ù„ ÙˆÙŠØ¬Ø¯ Ø§Ù„Ø­Ø¬Ø² pending
00:05 - ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ expired âœ…
```

### Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 2: Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØ¤ÙƒØ¯ Ø§Ù„Ø­Ø¬Ø²
```
00:00 - Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² (pending) 
00:02 - Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØ¤ÙƒØ¯ (confirmed)
00:05 - Job ÙŠØ¹Ù…Ù„ ÙˆÙŠØ¬Ø¯ Ø§Ù„Ø­Ø¬Ø² confirmed
00:05 - Ù„Ø§ ÙŠÙØ¹Ù„ Ø´ÙŠØ¡ âœ…
```

### Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 3: Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠÙ„ØºÙŠ Ø§Ù„Ø­Ø¬Ø²
```
00:00 - Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² (pending)
00:03 - Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠÙ„ØºÙŠ (canceled)
00:05 - Job ÙŠØ¹Ù…Ù„ ÙˆÙŠØ¬Ø¯ Ø§Ù„Ø­Ø¬Ø² canceled
00:05 - Ù„Ø§ ÙŠÙØ¹Ù„ Ø´ÙŠØ¡ âœ…
```

## ðŸ” Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù†Ø¸Ø§Ù…

### Logs Ø§Ù„Ù…Ø³Ø¬Ù„Ø©:
- Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø­Ø¬Ø²
- Ø¹Ù†Ø¯ Ø¹Ø¯Ù… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¬Ø²
- Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¬Ø² Ù‚Ø¨Ù„ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù„Ø©
- Ø¹Ù†Ø¯ ÙØ´Ù„ Ø§Ù„Ù€ Job

### Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ Log:
```
[2025-07-22 12:50:22] Reservation RES-7E2A36BA has been expired after 5 minutes
```

## ðŸŽ¯ ÙÙˆØ§Ø¦Ø¯ Ø§Ù„Ù†Ø¸Ø§Ù…

1. **ØªÙ†Ø¸ÙŠÙ ØªÙ„Ù‚Ø§Ø¦ÙŠ**: Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
2. **ØªÙˆÙÙŠØ± Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª**: ØªØ­Ø±ÙŠØ± Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ù„Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
3. **ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡**: ØªÙ‚Ù„ÙŠÙ„ Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
4. **Ù…Ø±Ø§Ù‚Ø¨Ø©**: ØªØ³Ø¬ÙŠÙ„ ÙƒØ§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
5. **Ù…Ø±ÙˆÙ†Ø©**: Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ø§ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø¤ÙƒØ¯Ø©

## âš¡ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„

1. **Queue System**: ÙŠØ¬Ø¨ ØªØ´ØºÙŠÙ„ `php artisan queue:work`
2. **Database**: Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¯Ø¹Ù… Ø­Ø§Ù„Ø© `expired`
3. **Logs**: Ù…Ø³Ø§Ø­Ø© ÙƒØ§ÙÙŠØ© Ù„Ø­ÙØ¸ Ø§Ù„Ù€ logs

## ðŸ”§ Ø§Ù„ØªØ®ØµÙŠØµ

### ØªØºÙŠÙŠØ± Ù…Ø¯Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±:
```php
// ÙÙŠ Reservation.php
ExpireReservationJob::dispatch($reservation->id)->delay(now()->addMinutes(10)); // 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† 5
```

### Ø¥Ø¶Ø§ÙØ© Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:
```php
// ÙÙŠ ExpireReservationJob.php
// Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
```

### ØªØ®ØµÙŠØµ Ø§Ù„Ø´Ø±ÙˆØ·:
```php
// Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙˆØ· Ø£Ø®Ø±Ù‰ Ù‚Ø¨Ù„ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
if ($reservation->status === self::STATUS_PENDING && $reservation->some_condition) {
    // Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
}
``` 
